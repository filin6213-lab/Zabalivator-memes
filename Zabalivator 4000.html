<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ó–∞–±–∞–ª–∏–≤–∞—Ç–æ—Ä4000</title>

<style>
* {
    -webkit-tap-highlight-color: transparent;
}

body {
    height: 100vh;
    margin: 0;
    font-family: 'Segoe UI Light', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    font-weight: 300;
    background: #000;
    color: white;
    overflow: hidden;
    position: relative;
    z-index: 10;
    transition: transform 0.15s ease;
}

.container {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 11;
}

h1 {
    font-size: 2.5rem;
    margin-bottom: 40px;
    text-align: center;
    position: relative;
    color: #ff006e;
    text-shadow: 0 0 10px rgba(255, 0, 110, 0.5);
    font-weight: 300;
    letter-spacing: 2px;
}

#sickBtn {
    padding: 20px 40px;
    font-size: 1.5rem;
    border: 1px solid rgba(255, 255, 255, 0.18);
    border-radius: 15px;
    cursor: pointer;
    margin: 10px;
    background: rgba(204, 51, 51, 0.7);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    color: white;
    position: relative;
    box-shadow: 0 8px 32px 0 rgba(204, 51, 51, 0.37);
    font-weight: 300;
    touch-action: manipulation;
    transition: transform 0.15s ease, box-shadow 0.15s ease;
}

#sickBtn::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 50%;
    background: linear-gradient(180deg, rgba(255,255,255,0.15) 0%, transparent 100%);
    border-radius: 15px 15px 0 0;
    pointer-events: none;
}

#sickBtn:active {
    transform: scale(0.95);
    box-shadow: 0 4px 16px 0 rgba(204, 51, 51, 0.37);
}

#healBtn {
    position: fixed;
    top: 10px;
    right: 10px;
    width: 70px;
    height: 70px;
    font-size: 2rem;
    background: rgba(42, 170, 153, 0.7);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.18);
    border-radius: 20px;
    display: none;
    cursor: pointer;
    z-index: 11;
    box-shadow: 0 8px 32px 0 rgba(42, 170, 153, 0.37);
    touch-action: manipulation;
    transition: all 0.15s ease;
}

#healBtn::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, transparent 50%);
    border-radius: 20px;
    pointer-events: none;
}

#healBtn:active {
    transform: scale(0.9);
}

#leaderboardBtn {
    position: fixed;
    top: 10px;
    left: 10px;
    padding: 12px 20px;
    font-size: 1rem;
    background: rgba(255, 215, 0, 0.7);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.18);
    border-radius: 15px;
    cursor: pointer;
    z-index: 11;
    box-shadow: 0 8px 32px 0 rgba(255, 215, 0, 0.37);
    touch-action: manipulation;
    transition: all 0.15s ease;
    color: #000;
    font-weight: 400;
}

#leaderboardBtn:disabled {
    transform: scale(0.95);
}

#message, #tip, #joke, #counter, #deathJoke {
    position: relative;
    text-align: center;
    margin: 8px 0;
    font-weight: 300;
}

#message { 
    font-size: 2.5rem; 
    font-weight: 300;
    letter-spacing: 1px;
}

#tip { 
    font-size: 1.1rem; 
    color: #ffdd44;
    padding: 8px 15px;
    background: rgba(255,221,68,0.2);
    border-radius: 10px;
}

#joke { 
    font-size: 1.1rem; 
    color: #00ffcc;
    padding: 8px 15px;
    background: rgba(0,255,204,0.2);
    border-radius: 10px;
}

#counter { 
    font-size: 1.1rem; 
    color: #dd77ff;
    padding: 8px 15px;
    background: rgba(221,119,255,0.2);
    border-radius: 10px;
}

#deathJoke { 
    font-size: 1.3rem; 
    color: #ff4444;
}

/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    z-index: 100;
    backdrop-filter: blur(5px);
}

.modal-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(30, 30, 30, 0.95);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.18);
    border-radius: 20px;
    padding: 30px;
    max-width: 500px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
}

.modal h2 {
    color: #ff006e;
    text-align: center;
    margin-top: 0;
    font-weight: 300;
    font-size: 2rem;
    text-shadow: 0 0 10px rgba(255, 0, 110, 0.5);
}

.close-btn {
    position: absolute;
    top: 15px;
    right: 15px;
    font-size: 2rem;
    cursor: pointer;
    color: #fff;
    background: none;
    border: none;
    transition: transform 0.2s;
}

.close-btn:active {
    transform: scale(0.9);
}

.leaderboard-list {
    margin: 20px 0;
}

.leaderboard-item {
    display: flex;
    justify-content: space-between;
    padding: 12px 15px;
    margin: 8px 0;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 10px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.leaderboard-item.top1 {
    background: rgba(255, 215, 0, 0.2);
    border-color: rgba(255, 215, 0, 0.4);
}

.leaderboard-item.top2 {
    background: rgba(192, 192, 192, 0.2);
    border-color: rgba(192, 192, 192, 0.4);
}

.leaderboard-item.top3 {
    background: rgba(205, 127, 50, 0.2);
    border-color: rgba(205, 127, 50, 0.4);
}

.leaderboard-rank {
    font-weight: 400;
    color: #ffdd44;
    min-width: 30px;
}

.leaderboard-name {
    flex: 1;
    margin: 0 15px;
}

.leaderboard-score {
    font-weight: 400;
    color: #00ffcc;
}

.nickname-input {
    width: 100%;
    padding: 12px;
    margin: 15px 0;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 10px;
    color: white;
    font-size: 1rem;
    font-family: inherit;
    box-sizing: border-box;
}

.nickname-input::placeholder {
    color: rgba(255, 255, 255, 0.5);
}

.save-nickname-btn {
    width: 100%;
    padding: 12px;
    background: rgba(42, 170, 153, 0.7);
    border: 1px solid rgba(255, 255, 255, 0.18);
    border-radius: 10px;
    color: white;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.15s ease;
    font-family: inherit;
}

.save-nickname-btn:active {
    transform: scale(0.98);
}

.current-nickname {
    text-align: center;
    color: #00ffcc;
    margin: 10px 0;
    font-size: 0.9rem;
}

.empty-leaderboard {
    text-align: center;
    color: rgba(255, 255, 255, 0.5);
    padding: 30px;
    font-size: 1.1rem;
}

/* –≠—Ñ—Ñ–µ–∫—Ç—ã */
@keyframes glow {
    0%, 100% { color: #ff0; text-shadow: 0 0 10px #ff0; transform: scale(1); }
    50% { color: #0f0; text-shadow: 0 0 15px #0f0; transform: scale(1.05); }
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.08); }
}

@keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    75% { transform: translateX(5px); }
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes borderGlow {
    0%, 100% { box-shadow: 0 8px 32px 0 rgba(204, 51, 51, 0.37); }
    50% { box-shadow: 0 8px 32px 0 rgba(255, 107, 107, 0.6); }
}

#message.glow { animation: glow 0.5s 3; }
#sickBtn.pulse { animation: pulse 0.3s 3, borderGlow 0.6s 3; }
#tip.shake { animation: shake 0.2s 3; }
#joke.shake { animation: shake 0.2s 3; }

.fadeIn { animation: fadeIn 0.4s ease-out; }

/* –í–∏–¥–µ–æ */
.videoLayer {
    position: fixed;
    left: 50%;
    transform: translateX(-50%);
    display: none;
    pointer-events: none;
    z-index: -1;
    opacity: 0.9;
}

#video42 { bottom: -120px; }
#video67 { bottom: -120px; }
#video149{ top: 30px; }
#video333 { bottom: -130px; }
#video456 { top: 30px; }

</style>
</head>
<body>

<div class="container">
<h1>–ó–∞–±–∞–ª–∏–≤–∞—Ç–æ—Ä4000</h1>

<button id="sickBtn">–•–æ—á—É –∑–∞–±–æ–ª–µ—Ç—å</button>

<div id="message"></div>
<div id="tip"></div>
<div id="joke"></div>
<div id="counter"></div>
<div id="deathJoke"></div>
</div>

<button id="healBtn">ü§í</button>
<button id="leaderboardBtn">üèÜ –õ–∏–¥–µ—Ä—ã</button>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ç–∞–±–ª–∏—Ü—ã –ª–∏–¥–µ—Ä–æ–≤ -->
<div id="leaderboardModal" class="modal">
    <div class="modal-content">
        <button class="close-btn">&times;</button>
        <h2>üèÜ –¢–∞–±–ª–∏—Ü–∞ –õ–∏–¥–µ—Ä–æ–≤</h2>
        
        <div class="current-nickname" id="currentNickname"></div>
        
        <div style="margin: 20px 0;">
            <input type="text" id="nicknameInput" class="nickname-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–∏–∫" maxlength="20">
            <button id="saveNicknameBtn" class="save-nickname-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∏–∫</button>
        </div>
        
        <div class="leaderboard-list" id="leaderboardList"></div>
    </div>
</div>

<!-- –í–ò–î–ï–û –ü–ê–°–•–ê–õ–ö–ò -->
<video id="video42" class="videoLayer" width="220" autoplay playsinline>
  <source src="https://github.com/filin6213-lab/Zabalivator-memes/raw/refs/heads/main/video_20251201_205930.mp4" type="video/mp4">
</video>

<video id="video67" class="videoLayer" width="220" autoplay muted>
  <source src="https://github.com/filin6213-lab/Zabalivator-memes/raw/refs/heads/main/2025-12-01-202815693.mp4" type="video/mp4">
</video>

<video id="video149" class="videoLayer" width="220" loop autoplay muted>
  <source src="https://github.com/filin6213-lab/Zabalivator-memes/raw/refs/heads/main/qotaqbas.ss_2025-12-01-20-58-24_1764597504856.mp4" type="video/mp4">
</video>

<video id="video333" class="videoLayer" width="220" autoplay muted>
  <source src="https://github.com/filin6213-lab/Zabalivator-memes/raw/refs/heads/main/video_20251201_212347.mp4" type="video/mp4">
</video>

<video id="video456" class="videoLayer" width="220" loop autoplay playsinline>
  <source src="https://github.com/filin6213-lab/Zabalivator-memes/raw/refs/heads/main/mangolik.__2025-12-01-21-28-47_1764599327045.mp4" type="video/mp4">
</video>


<script>
const button=document.getElementById("sickBtn");
const healBtn=document.getElementById("healBtn");
const messageDiv=document.getElementById("message");
const tipDiv=document.getElementById("tip");
const jokeDiv=document.getElementById("joke");
const counterDiv=document.getElementById("counter");
const deathDiv=document.getElementById("deathJoke");

const leaderboardBtn=document.getElementById("leaderboardBtn");
const leaderboardModal=document.getElementById("leaderboardModal");
const closeBtn=document.querySelector(".close-btn");
const nicknameInput=document.getElementById("nicknameInput");
const saveNicknameBtn=document.getElementById("saveNicknameBtn");
const currentNickname=document.getElementById("currentNickname");
const leaderboardList=document.getElementById("leaderboardList");

const video42=document.getElementById("video42");
const video67=document.getElementById("video67");
const video149=document.getElementById("video149");
const video333=document.getElementById("video333");
const video456=document.getElementById("video456");

let sicknessCount=0;
let gameOver=false;
let video149Playing=false;
let video456Playing=false;
let playerNickname = "";
// –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∏–∫–∞ –∏–∑ localStorage
const savedNick = localStorage.getItem('zabalivator_nickname');
if (savedNick) playerNickname = savedNick;

const diseases=["–ü—Ä–æ—Å—Ç—É–¥–∞","Covid-19","–ì—Ä–∏–ø–ø","–ê–Ω–≥–∏–Ω–∞","–ë—Ä–æ–Ω—Ö–∏—Ç","–ü–Ω–µ–≤–º–æ–Ω–∏—è","–í–µ—Ç—Ä—è–Ω–∞—è –æ—Å–ø–∞","–î–∏–∞—Ä–µ—è","–ì–∞–π–º–æ—Ä–∏—Ç","–ö–æ—Ä—å","–û–†–í–ò","–û—Ç–∏—Ç","–°—Ç–æ–º–∞—Ç–∏—Ç","–ú–∏–≥—Ä–µ–Ω—å","–ê–ª–ª–µ—Ä–≥–∏—è",
"–¢–æ–Ω–∑–∏–ª–ª–∏—Ç","–ì–∞—Å—Ç—Ä–∏—Ç","–Ø–∑–≤–∞","–ì–µ–ø–∞—Ç–∏—Ç","–ú–æ–Ω–æ–Ω—É–∫–ª–µ–æ–∑","–†–µ–≤–º–∞—Ç–∏–∑–º","–ê–Ω–µ–º–∏—è","–î–∏–∞–±–µ—Ç","–¢—É–±–µ—Ä–∫—É–ª–µ–∑","–ú–∞–ª—è—Ä–∏—è","–ö—Ä–∞—Å–Ω—É—Ö–∞","–°–∫–∞—Ä–ª–∞—Ç–∏–Ω–∞","–ü–∞—Ä–æ—Ç–∏—Ç","–ú–µ–Ω–∏–Ω–≥–∏—Ç",
"–°–∏—Ñ–∏–ª–∏—Å","–ì—Ä–∏–ø–ø H1N1","–¶–∏—Å—Ç–∏—Ç","–§–∞—Ä–∏–Ω–≥–∏—Ç","–ü–∞–Ω–∫—Ä–µ–∞—Ç–∏—Ç","–ü–Ω–µ–≤–º–æ—Ç–æ—Ä–∞–∫—Å","–ê—Å—Ç–º–∞","–ü—Å–æ—Ä–∏–∞–∑","–≠–∫–∑–µ–º–∞","–•–æ–ª–µ—Ä–∞","–î–∏–∑–µ–Ω—Ç–µ—Ä–∏—è","–õ–µ–ø—Ä–∞","–ü–æ–ª–∏–æ–º–∏–µ–ª–∏—Ç","–ë–µ—à–µ–Ω—Å—Ç–≤–æ",
"–í–æ—Å–ø–æ–ª–Ω–µ–Ω–∏–µ —Ö–∏—Ç—Ä–æ—Å—Ç–∏","–Ø –≥–æ–ª–æ–≤—É –¥–æ–º–∞ –∑–∞–±—ã–ª","–ü—Ä–æ–≥—É–ª","–£–≤–∞–∂–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞","–ö–æ—Ñ–µ–π–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å","–°–∏–Ω–¥—Ä–æ–º –¥–≤–æ–π–Ω–æ–≥–æ —Ç–∞–ø–∫–∞","–•—Ä–æ–Ω–∏—á–µ—Å–∫–∞—è —Å–∫—É–∫–∞","–°–∏–Ω–¥—Ä–æ–º TikTok-–∫–æ–º–µ–Ω—Ç–∞",
"–ò–Ω—Ç–µ—Ä–Ω–µ—Ç–Ω–∞—è —É—Å—Ç–∞–ª–æ—Å—Ç—å","–ë–µ—Å—Å–æ–Ω–Ω–∏—Ü–∞","–°–∏–Ω–¥—Ä–æ–º –º–µ–º–Ω–æ–≥–æ –≥–ª–∞–∑–∞","–ü—Ä–æ–±–ª–µ–º—ã —Å Wi-Fi","–°–∏–Ω–¥—Ä–æ–º –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö —Å–≤–∞–π–ø–æ–≤","–†–∞–Ω–¥–æ–º–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è","–í–∏—Ä—É—Å –º–µ–º–æ–≤","–≠–ø–∏–¥–µ–º–∏—á–µ—Å–∫–∏–π —Ñ–ª–µ—à–º–æ–±",
"–°–î–í–ì —Ç–∏–∫—Ç–æ—á–µ—Å—Ç–≤–æ","–•—Ä–æ–Ω–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏—è","–≠–ø–∏–¥–µ–º–∏—á–µ—Å–∫–∏–π –º–µ–º–æ–∑","–ò–Ω—Ç–µ—Ä–Ω–µ—Ç–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å","–ü–µ—Ä–µ–≥—Ä–µ–≤ –º–æ–∑–≥–∞","–°–∏–Ω–¥—Ä–æ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π","–ü—Ä—ã—â–∏ –æ—Ç TikTok",
"–ü—Ä–æ–±–ª–µ–º—ã —Å –¥–æ–º–∞—à–∫–æ–π","–≠–ø–∏–¥–µ–º–∏—á–µ—Å–∫–∞—è —Å–æ–Ω–ª–∏–≤–æ—Å—Ç—å","–ù–µ–≤—ã—Å–ø–∞–Ω–Ω–æ—Å—Ç—å","–°—Ç—Ä–µ—Å—Å –æ—Ç —Å–º–∞–π–ª–∏–∫–æ–≤","–ü–æ—Ç–µ—Ä—è –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏","–í–µ—á–Ω—ã–π –æ–±–µ–¥","–°–æ—Ü–∏–∞–ª—å–Ω–∞—è —É—Å—Ç–∞–ª–æ—Å—Ç—å","–ú–∞–≥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ—Å—Ç—É–¥–∞"];

const tips=["–ü–æ–ø–µ–π—Ç–µ —á–∞–π","–ü—Ä–æ–≤–µ—Ç—Ä–∏—Ç–µ –∫–æ–º–Ω–∞—Ç—É","–û—Ç–¥–æ—Ö–Ω–∏—Ç–µ","–ì–ª—É–±–æ–∫–æ –≤–¥–æ—Ö–Ω–∏—Ç–µ","–†–∞—Å—Ç—è–Ω–∏—Ç–µ—Å—å","–ü—Ä–æ–π–¥–∏—Ç–µ—Å—å","–í—ã–ø–µ–π –≤–æ–¥—ã"];
const simpleJokes=["67","SiX sEvEn","–°—É–±–æ –±—Ä–∞—Ç–∏–∫","–¢—ã —á–µ —Ç–æ–∂–µ –∑–¥–µ—Å—å?","–ö—Ç–æ –ø–æ–º–Ω–∏—Ç 42?"];

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
async function init() {
    await loadNickname();
    updateNicknameDisplay();
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∏–∫–∞
async function loadNickname() {
    try {
        const result = await window.storage.get('player_nickname');
        if (result && result.value) {
            playerNickname = result.value;
        }
    } catch (error) {
        console.log('–ù–∏–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–Ω–æ–Ω–∏–º–Ω—ã–π —Ä–µ–∂–∏–º');
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∏–∫–∞
function updateNicknameDisplay() {
    if (playerNickname) {
        currentNickname.textContent = `–í–∞—à –Ω–∏–∫: ${playerNickname}`;
        nicknameInput.value = playerNickname;
    } else {
        currentNickname.textContent = '–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –Ω–∏–∫–∞';
    }
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∏–∫–∞
saveNicknameBtn.addEventListener('click', async () => {
    const newNickname = nicknameInput.value.trim();
    if (newNickname.length === 0) {
        alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫!');
        return;
    }
    if (newNickname.length > 20) {
        alert('–ù–∏–∫ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π! –ú–∞–∫—Å–∏–º—É–º 20 —Å–∏–º–≤–æ–ª–æ–≤.');
        return;
    }
    
    try {
        await window.storage.set('player_nickname', newNickname);
        playerNickname = newNickname;
        updateNicknameDisplay();
        alert('–ù–∏–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω! ‚úÖ');
    } catch (error) {
        alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∏–∫–∞');
        console.error(error);
    }
});

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∫–æ—Ä–¥–∞ –≤ —Ç–∞–±–ª–∏—Ü—É –ª–∏–¥–µ—Ä–æ–≤
async function saveScore(score) {
    if (!playerNickname) {
        return;
    }
    
    try {
        const playerId = `player_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
        await window.storage.set(`leaderboard:${playerId}`, JSON.stringify({
            nickname: playerNickname,
            score: score,
            date: new Date().toISOString()
        }), true);
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∫–æ—Ä–¥–∞:', error);
    }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∞–±–ª–∏—Ü—ã –ª–∏–¥–µ—Ä–æ–≤
async function loadLeaderboard() {
    try {
        const keys = await window.storage.list('leaderboard:', true);
        if (!keys || !keys.keys || keys.keys.length === 0) {
            leaderboardList.innerHTML = '<div class="empty-leaderboard">–¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤ –ø—É—Å—Ç–∞<br>–ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º! üéØ</div>';
            return;
        }
        
        const scores = [];
        for (const key of keys.keys) {
            try {
                const result = await window.storage.get(key, true);
                if (result && result.value) {
                    const data = JSON.parse(result.value);
                    scores.push(data);
                }
            } catch (e) {
                console.log('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–ø–∏—Å–∏:', e);
            }
        }
        
        scores.sort((a, b) => b.score - a.score);
        const top10 = scores.slice(0, 10);
        
        if (top10.length === 0) {
            leaderboardList.innerHTML = '<div class="empty-leaderboard">–¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤ –ø—É—Å—Ç–∞<br>–ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º! üéØ</div>';
            return;
        }
        
        leaderboardList.innerHTML = top10.map((entry, index) => {
            let rankClass = '';
            let medal = '';
            if (index === 0) {
                rankClass = 'top1';
                medal = 'ü•á';
            } else if (index === 1) {
                rankClass = 'top2';
                medal = 'ü•à';
            } else if (index === 2) {
                rankClass = 'top3';
                medal = 'ü•â';
            }
            
            return `
                <div class="leaderboard-item ${rankClass}">
                    <span class="leaderboard-rank">${medal || (index + 1) + '.'}</span>
                    <span class="leaderboard-name">${escapeHtml(entry.nickname)}</span>
                    <span class="leaderboard-score">ü¶† ${entry.score}</span>
                </div>
            `;
        }).join('');
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∞–±–ª–∏—Ü—ã –ª–∏–¥–µ—Ä–æ–≤:', error);
        leaderboardList.innerHTML = '<div class="empty-leaderboard">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∞–±–ª–∏—Ü—ã</div>';
    }
}

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
leaderboardBtn.addEventListener('click', async () => {
    leaderboardModal.style.display = 'block';
    await loadLeaderboard();
});

// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
closeBtn.addEventListener('click', () => {
    leaderboardModal.style.display = 'none';
});

leaderboardModal.addEventListener('click', (e) => {
    if (e.target === leaderboardModal) {
        leaderboardModal.style.display = 'none';
    }
});

// –≠–§–§–ï–ö–¢ –ù–ê–ñ–ê–¢–ò–Ø –ü–û –≠–ö–†–ê–ù–£
document.body.addEventListener('touchstart', function(e) {
    if(e.target === button || e.target === healBtn || e.target === leaderboardBtn) return;
    createTapEffect(e.touches[0].clientX, e.touches[0].clientY);
}, {passive: true});

document.body.addEventListener('click', function(e) {
    if(e.target === button || e.target === healBtn || e.target === leaderboardBtn) return;
    createTapEffect(e.clientX, e.clientY);
});

function createTapEffect(x, y) {
    const ripple = document.createElement('div');
    ripple.style.cssText = `
        position: fixed;
        top: ${y}px;
        left: ${x}px;
        width: 10px;
        height: 10px;
        border: 2px solid rgba(255, 255, 255, 0.6);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        z-index: 1000;
        pointer-events: none;
    `;
    document.body.appendChild(ripple);
    
    let size = 10;
    let opacity = 0.6;
    
    const animate = () => {
        size += 6;
        opacity -= 0.04;
        ripple.style.width = size + 'px';
        ripple.style.height = size + 'px';
        ripple.style.opacity = opacity;
        
        if (opacity > 0) {
            requestAnimationFrame(animate);
        } else {
            ripple.remove();
        }
    };
    requestAnimationFrame(animate);
}

function getSick(){
    if(gameOver) return;

    if(Math.random()<0.003){
        triggerDeath();
        return;
    }

    if(Math.random()<0.08){
        document.body.style.background="#003300";
        messageDiv.textContent="–¢—ã –Ω–µ –∑–∞–±–æ–ª–µ–ª!";
        messageDiv.style.color = "#00ff00";
        messageDiv.style.textShadow = "0 0 20px #00ff00";
        messageDiv.classList.add("fadeIn");
        healBtn.style.display="none";
        tipDiv.textContent="";
        jokeDiv.textContent="";
        counterDiv.textContent="";
        createConfetti(15);
        return;
    }

    document.body.style.background="#000";
    messageDiv.style.color = "white";
    messageDiv.style.textShadow = "";

    const disease=diseases[Math.floor(Math.random()*diseases.length)];
    messageDiv.textContent=disease;
    messageDiv.classList.add("fadeIn");

    applyVisualEffects();
    healBtn.style.display="inline";

    if(Math.random()<0.3) {
        jokeDiv.textContent=simpleJokes[Math.floor(Math.random()*simpleJokes.length)];
        jokeDiv.classList.add("fadeIn");
    } else {
        jokeDiv.textContent="";
    }
    tipDiv.textContent=tips[Math.floor(Math.random()*tips.length)];
    tipDiv.classList.add("fadeIn");

    sicknessCounter();
}

function createConfetti(count) {
    const buttonRect = button.getBoundingClientRect();
    const buttonCenterY = buttonRect.top + buttonRect.height / 2;
    
    for(let i = 0; i < count; i++) {
        setTimeout(() => {
            const confetti = document.createElement('div');
            const hue = Math.random() * 360;
            const left = Math.random() * 100;
            
            confetti.style.cssText = `
                position: fixed;
                width: 8px;
                height: 8px;
                background: hsl(${hue}, 100%, 60%);
                top: -10px;
                left: ${left}%;
                z-index: 12;
                border-radius: 50%;
                pointer-events: none;
            `;
            document.body.appendChild(confetti);
            
            let y = -10, opacity = 1;
            const speed = 3 + Math.random() * 2;
            
            const animate = () => {
                y += speed;
                opacity -= (Math.abs(y - buttonCenterY) < 100) ? 0.05 : 0.015;
                
                confetti.style.transform = `translateY(${y}px) rotate(${y * 2}deg)`;
                confetti.style.opacity = opacity;
                
                if (opacity > 0 && y < window.innerHeight) {
                    requestAnimationFrame(animate);
                } else {
                    confetti.remove();
                }
            };
            requestAnimationFrame(animate);
        }, i * 30);
    }
}

function sicknessCounter(){
    sicknessCount++;
    counterDiv.textContent="–í—ã –∑–∞–±–æ–ª–µ–ª–∏ —É–∂–µ "+sicknessCount+" —Ä–∞–∑.";
    counterDiv.classList.add("fadeIn");

    if(sicknessCount===42) playVideo(video42,true);
    if(sicknessCount===67) playVideo(video67,false);
    if(sicknessCount===333) playVideo(video333,false);

    if(sicknessCount===149){
        video149.style.display="block";
        video149Playing=true;
        return;
    }

    if(video149Playing){
        video149.style.display="none";
        video149Playing=false;
    }

    if(sicknessCount===456){
        video456.style.display="block";
        video456Playing=true;
        video456.play();
        return;
    }

    if(video456Playing){
        video456.style.display="none";
        video456Playing=false;
    }
}

function playVideo(videoElement,withSound){
    videoElement.style.display="block";
    let pos=-120;
    const interval=setInterval(()=>{
        pos+=4;
        videoElement.style.bottom=pos+"px";
        if(pos>window.innerHeight){
            clearInterval(interval);
            videoElement.style.display="none";
        }
    },20);
    if(withSound) videoElement.play();
}

function applyVisualEffects(){
    messageDiv.classList.remove("glow", "fadeIn");
    button.classList.remove("pulse");
    tipDiv.classList.remove("shake", "fadeIn");
    jokeDiv.classList.remove("shake", "fadeIn");
    counterDiv.classList.remove("fadeIn");
    
    setTimeout(()=>{
        messageDiv.classList.add("glow");
        button.classList.add("pulse");
        tipDiv.classList.add("shake");
        jokeDiv.classList.add("shake");
    }, 10);
    
    document.body.style.transform="rotate(8deg)";
    setTimeout(()=>{ document.body.style.transform="rotate(-8deg)"; }, 100);
    setTimeout(()=>{ document.body.style.transform="rotate(0deg)"; }, 200);
    
    document.body.style.background="radial-gradient(circle, #440044 0%, #000 100%)";
    setTimeout(()=>{ document.body.style.background="#000"; }, 150);
    
    createRipple();
}

function createRipple() {
    const rect = button.getBoundingClientRect();
    const ripple = document.createElement('div');
    
    ripple.style.cssText = `
        position: fixed;
        top: ${rect.top + rect.height/2}px;
        left: ${rect.left + rect.width/2}px;
        width: 20px;
        height: 20px;
        border: 2px solid #ff6b6b;
        border-radius: 50%;
        transform: translate(-50%, -50%);
        z-index: 10;
        pointer-events: none;
    `;
    document.body.appendChild(ripple);
    
    let size = 20, opacity = 1;
    
    const animate = () => {
        size += 8;
        opacity -= 0.05;
        ripple.style.width = size + 'px';
        ripple.style.height = size + 'px';
        ripple.style.opacity = opacity;
        
        if (opacity > 0) {
            requestAnimationFrame(animate);
        } else {
            ripple.remove();
        }
    };
    requestAnimationFrame(animate);
}

function startRecoveryTimer(){
    let t=4;
    counterDiv.textContent="–í—ã–∑–¥–æ—Ä–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ "+t+" —Å–µ–∫";
    counterDiv.classList.add("fadeIn");
    
    let int=setInterval(()=>{
        t--;
        counterDiv.textContent="–í—ã–∑–¥–æ—Ä–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ "+t+" —Å–µ–∫";
        if(t<=0){
            clearInterval(int);
            messageDiv.textContent="";
            tipDiv.textContent="";
            jokeDiv.textContent="";
            counterDiv.textContent="–í—ã –≤—ã–∑–¥–æ—Ä–æ–≤–µ–ª–∏!";
            counterDiv.classList.add("fadeIn");
            healBtn.style.display="none";
            document.body.style.background="#003300";
            
            messageDiv.classList.remove("glow");
            button.classList.remove("pulse");
            tipDiv.classList.remove("shake");
            jokeDiv.classList.remove("shake");
            
            healEffect();
        }
    },1000);
}

function healEffect() {
    const glow = document.createElement('div');
    glow.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        width: 100px;
        height: 100px;
        background: radial-gradient(circle, rgba(0,255,0,0.6) 0%, transparent 70%);
        transform: translate(-50%, -50%);
        z-index: 9;
        pointer-events: none;
    `;
    document.body.appendChild(glow);
    
    let size = 100, opacity = 0.6;
    
    const animate = () => {
        size += 10;
        opacity -= 0.03;
        glow.style.width = size + 'px';
        glow.style.height = size + 'px';
        glow.style.opacity = opacity;
        
        if (opacity > 0) {
            requestAnimationFrame(animate);
        } else {
            glow.remove();
        }
    };
    requestAnimationFrame(animate);
}

async function triggerDeath(){
    gameOver=true;
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∫–æ—Ä–¥ –≤ —Ç–∞–±–ª–∏—Ü—É –ª–∏–¥–µ—Ä–æ–≤
    await saveScore(sicknessCount);
    
    document.body.style.background="#1a0000";
    button.textContent="–¢—ã –ú—ë—Ä—Ç–≤! üíÄ";
    button.style.background="rgba(68, 68, 68, 0.7)";
    button.disabled=true;
    healBtn.style.display="none";
    messageDiv.textContent="–í—ã –£–º–µ—Ä–ª–∏! –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ó–∞–±–∞–ª–∏–≤–∞—Ç–æ—Ä4000!";
    messageDiv.classList.add("fadeIn");
    deathDiv.textContent="–í–æ—Ç –∏ —Å–∫–∞–∑–∞—á–∫–µ –∫–æ–Ω–µ—Ü! –í–∞—à —Å—á—ë—Ç: " + sicknessCount + " ü¶†";
    
    messageDiv.classList.remove("glow");
    button.classList.remove("pulse");
    tipDiv.classList.remove("shake");
    jokeDiv.classList.remove("shake");
    
    deathEffect();
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ä–µ–∫–æ—Ä–¥–∞
    if (playerNickname) {
        setTimeout(() => {
            tipDiv.textContent = "–í–∞—à —Ä–µ–∫–æ—Ä–¥ —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ —Ç–∞–±–ª–∏—Ü–µ –ª–∏–¥–µ—Ä–æ–≤! üèÜ";
            tipDiv.classList.add("fadeIn");
        }, 2000);
    } else {
        setTimeout(() => {
            tipDiv.textContent = "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–∏–∫, —á—Ç–æ–±—ã –ø–æ–ø–∞—Å—Ç—å –≤ —Ç–∞–±–ª–∏—Ü—É –ª–∏–¥–µ—Ä–æ–≤!";
            tipDiv.classList.add("fadeIn");
        }, 2000);
    }
}

function deathEffect() {
    for(let i = 0; i < 3; i++) {
        setTimeout(() => {
            const wave = document.createElement('div');
            wave.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                width: 50px;
                height: 50px;
                border: 3px solid #ff0000;
                border-radius: 50%;
                transform: translate(-50%, -50%);
                z-index: 9;
                pointer-events: none;
            `;
            document.body.appendChild(wave);
            
            let size = 50, opacity = 1;
            
            const animate = () => {
                size += 15;
                opacity -= 0.04;
                wave.style.width = size + 'px';
                wave.style.height = size + 'px';
                wave.style.opacity = opacity;
                
                if (opacity > 0) {
                    requestAnimationFrame(animate);
                } else {
                    wave.remove();
                }
            };
            requestAnimationFrame(animate);
        }, i * 200);
    }
}

button.addEventListener("touchstart",(e)=>{
    e.preventDefault();
    getSick();
});
button.addEventListener("click",getSick);

healBtn.addEventListener("touchstart",(e)=>{
    e.preventDefault();
    startRecoveryTimer();
});
healBtn.addEventListener("click",startRecoveryTimer);

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
init();
</script>
</body>
</html>